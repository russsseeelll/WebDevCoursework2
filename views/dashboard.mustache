<div class="page-content">
    <h2 class="mb-4 text-center">Organiser (Admin)</h2>

    <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="courses-tab" data-bs-toggle="tab" data-bs-target="#coursesTab" type="button" role="tab" aria-controls="coursesTab" aria-selected="false">Courses</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="classes-tab" data-bs-toggle="tab" data-bs-target="#classesTab" type="button" role="tab" aria-controls="classesTab" aria-selected="false">Classes</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#usersTab" type="button" role="tab" aria-controls="usersTab" aria-selected="false">Users</button>
        </li>
    </ul>

    <div class="tab-content mt-3" id="dashboardTabsContent">

        <div class="tab-pane fade" id="coursesTab" role="tabpanel" aria-labelledby="courses-tab">
            <div class="mb-3 text-end">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCourseModal">Add New Course</button>
            </div>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>Course Name</th>
                        <th>Duration</th>
                        <th>Schedule</th>
                        <th>Price</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    {{#courses}}
                        <tr>
                            <td>{{name}}</td>
                            <td>{{duration}}</td>
                            <td>{{schedule}}</td>
                            <td>{{price}}</td>
                            <td>

                                <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#editCourseModal-{{_id}}">Edit</button>

                                <form action="/api/courses/delete" method="POST" style="display:inline;">
                                    <input type="hidden" name="courseId" value="{{_id}}">
                                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                </form>

                                <button class="btn btn-sm btn-info" data-bs-toggle="modal" data-bs-target="#participantsModal-{{_id}}">Participants</button>
                            </td>
                        </tr>
                    {{/courses}}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="tab-pane fade" id="classesTab" role="tabpanel" aria-labelledby="classes-tab">
            <div class="mb-3 text-end">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addClassModal">Add New Class</button>
            </div>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>Class Name</th>
                        <th>Description</th>
                        <th>Location</th>
                        <th>Price</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    {{#classes}}
                        <tr>
                            <td>{{name}}</td>
                            <td>{{description}}</td>
                            <td>{{location}}</td>
                            <td>{{price}}</td>
                            <td>

                                <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#editClassModal-{{_id}}">Edit</button>

                                <form action="/api/classes/delete" method="POST" style="display:inline;">
                                    <input type="hidden" name="classId" value="{{_id}}">
                                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                </form>

                                <button class="btn btn-sm btn-info manage-timeslots-btn" data-bs-toggle="modal" data-bs-target="#timeslotManagementModal" data-classid="{{_id}}" data-classname="{{name}}">Timeslot Management</button>

                                <button class="btn btn-sm btn-secondary" data-bs-toggle="modal" data-bs-target="#participantsClassModal-{{_id}}">Participants</button>
                            </td>
                        </tr>
                    {{/classes}}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="tab-pane fade" id="usersTab" role="tabpanel" aria-labelledby="users-tab">
            <div class="mb-3 text-end">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">Add New User</button>
            </div>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>User Name</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    {{#users}}
                        <tr>
                            <td>{{name}}</td>
                            <td>{{email}}</td>
                            <td>{{role}}</td>
                            <td>

                                <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#editUserModal-{{_id}}">Edit</button>

                                <form action="/users/delete" method="POST" style="display:inline;">
                                    <input type="hidden" name="userId" value="{{_id}}">
                                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                </form>
                            </td>
                        </tr>
                    {{/users}}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addCourseModal" tabindex="-1" aria-labelledby="addCourseModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="/api/courses/add" method="POST" novalidate>
                <div class="modal-header">
                    <h5 class="modal-title" id="addCourseModalLabel">Add New Course</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <div class="mb-3">
                        <label for="courseName" class="form-label">Course Name</label>
                        <input type="text" class="form-control" id="courseName" name="courseName" placeholder="Enter course name" required>
                    </div>

                    <div class="mb-3">
                        <label for="courseDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="courseDescription" name="courseDescription" placeholder="Enter course description" required></textarea>
                    </div>

                    <div class="mb-3">
                        <label for="courseStartDate" class="form-label">Start Date</label>
                        <input type="date" class="form-control" id="courseStartDate" name="courseStartDate" required>
                        <small class="form-text text-muted">Select a start date that falls on one of the scheduled days.</small>
                    </div>

                    <div class="mb-3">
                        <label for="courseDuration" class="form-label">Duration (Weeks)</label>
                        <select class="form-select" id="courseDuration" name="courseDuration" required>
                            <option value="">Select duration</option>
                            <option value="4">4 weeks</option>
                            <option value="6">6 weeks</option>
                            <option value="8">8 weeks</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Schedule (Days)</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="Monday" id="dayMonday" name="courseSchedule">
                            <label class="form-check-label" for="dayMonday">Monday</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="Tuesday" id="dayTuesday" name="courseSchedule">
                            <label class="form-check-label" for="dayTuesday">Tuesday</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="Wednesday" id="dayWednesday" name="courseSchedule">
                            <label class="form-check-label" for="dayWednesday">Wednesday</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="Thursday" id="dayThursday" name="courseSchedule">
                            <label class="form-check-label" for="dayThursday">Thursday</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="Friday" id="dayFriday" name="courseSchedule">
                            <label class="form-check-label" for="dayFriday">Friday</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="Saturday" id="daySaturday" name="courseSchedule">
                            <label class="form-check-label" for="daySaturday">Saturday</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="Sunday" id="daySunday" name="courseSchedule">
                            <label class="form-check-label" for="daySunday">Sunday</label>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="coursePrice" class="form-label">Price</label>
                        <div class="input-group">
                            <span class="input-group-text">£</span>
                            <input type="number" class="form-control" id="coursePrice" name="coursePrice" placeholder="Amount" min="0" required>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="courseLocation" class="form-label">Location</label>
                        <input type="text" class="form-control" id="courseLocation" name="courseLocation" placeholder="Enter location" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Course Time</label>
                        <div class="row">
                            <div class="col">
                                <input type="time" class="form-control" id="courseStartTime" name="courseStartTime" placeholder="Start Time" required>
                            </div>
                            <div class="col">
                                <input type="time" class="form-control" id="courseEndTime" name="courseEndTime" placeholder="End Time" required>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save Course</button>
                </div>
            </form>
        </div>
    </div>
</div>

{{#courses}}
    <div class="modal fade" id="editCourseModal-{{_id}}" tabindex="-1" aria-labelledby="editCourseModalLabel-{{_id}}" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">

                <form action="/api/courses/edit" method="POST" novalidate>
                    <input type="hidden" name="courseId" value="{{_id}}">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editCourseModalLabel-{{_id}}">Edit Course - {{name}}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">

                        <div class="mb-3">
                            <label for="courseName-{{_id}}" class="form-label">Course Name</label>
                            <input type="text" class="form-control" id="courseName-{{_id}}" name="courseName" value="{{name}}" placeholder="Enter course name" required>
                        </div>

                        <div class="mb-3">
                            <label for="courseDescription-{{_id}}" class="form-label">Description</label>
                            <textarea class="form-control" id="courseDescription-{{_id}}" name="courseDescription" placeholder="Enter course description" required>{{description}}</textarea>
                        </div>

                        <div class="mb-3">
                            <label for="courseStartDate-{{_id}}" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="courseStartDate-{{_id}}" name="courseStartDate" value="{{startDate}}" required>
                            <small class="form-text text-muted">Start date must fall on one of the scheduled days.</small>
                        </div>

                        <div class="mb-3">
                            <label for="courseDuration-{{_id}}" class="form-label">Duration (Weeks)</label>
                            <select class="form-select" id="courseDuration-{{_id}}" name="courseDuration" required>
                                <option value="">Select duration</option>
                                <option value="4" {{#durationIs4}}selected{{/durationIs4}}>4 weeks</option>
                                <option value="6" {{#durationIs6}}selected{{/durationIs6}}>6 weeks</option>
                                <option value="8" {{#durationIs8}}selected{{/durationIs8}}>8 weeks</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Schedule (Days)</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="Monday" id="dayMonday-{{_id}}" name="courseSchedule" {{#isMonday}}checked{{/isMonday}}>
                                <label class="form-check-label" for="dayMonday-{{_id}}">Monday</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="Tuesday" id="dayTuesday-{{_id}}" name="courseSchedule" {{#isTuesday}}checked{{/isTuesday}}>
                                <label class="form-check-label" for="dayTuesday-{{_id}}">Tuesday</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="Wednesday" id="dayWednesday-{{_id}}" name="courseSchedule" {{#isWednesday}}checked{{/isWednesday}}>
                                <label class="form-check-label" for="dayWednesday-{{_id}}">Wednesday</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="Thursday" id="dayThursday-{{_id}}" name="courseSchedule" {{#isThursday}}checked{{/isThursday}}>
                                <label class="form-check-label" for="dayThursday-{{_id}}">Thursday</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="Friday" id="dayFriday-{{_id}}" name="courseSchedule" {{#isFriday}}checked{{/isFriday}}>
                                <label class="form-check-label" for="dayFriday-{{_id}}">Friday</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="Saturday" id="daySaturday-{{_id}}" name="courseSchedule" {{#isSaturday}}checked{{/isSaturday}}>
                                <label class="form-check-label" for="daySaturday-{{_id}}">Saturday</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="Sunday" id="daySunday-{{_id}}" name="courseSchedule" {{#isSunday}}checked{{/isSunday}}>
                                <label class="form-check-label" for="daySunday-{{_id}}">Sunday</label>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="coursePrice-{{_id}}" class="form-label">Price</label>
                            <div class="input-group">
                                <span class="input-group-text">£</span>
                                <input type="number" class="form-control" id="coursePrice-{{_id}}" name="coursePrice" value="{{price}}" placeholder="Amount" min="0" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="courseLocation-{{_id}}" class="form-label">Location</label>
                            <input type="text" class="form-control" id="courseLocation-{{_id}}" name="courseLocation" value="{{location}}" placeholder="Enter location" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Course Time</label>
                            <div class="row">
                                <div class="col">
                                    <input type="time" class="form-control" id="courseStartTime-{{_id}}" name="courseStartTime" value="{{startTime}}" placeholder="Start Time" required>
                                </div>
                                <div class="col">
                                    <input type="time" class="form-control" id="courseEndTime-{{_id}}" name="courseEndTime" value="{{endTime}}" placeholder="End Time" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-warning">Update Course</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{{/courses}}

{{#courses}}
    <div class="modal fade" id="participantsModal-{{_id}}" tabindex="-1" aria-labelledby="participantsModalLabel-{{_id}}" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="participantsModalLabel-{{_id}}">Participants for {{name}}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul class="list-group">
                        {{#participants}}
                            <li class="list-group-item">{{name}} ({{email}})</li>
                        {{/participants}}
                        {{^participants}}
                            <li class="list-group-item">No participants yet.</li>
                        {{/participants}}
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
{{/courses}}

<div class="modal fade" id="addClassModal" tabindex="-1" aria-labelledby="addClassModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="/api/classes/add" method="POST" novalidate>
                <div class="modal-header">
                    <h5 class="modal-title" id="addClassModalLabel">Add New Class</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <div class="mb-3">
                        <label for="className" class="form-label">Class Name</label>
                        <input type="text" class="form-control" id="className" name="className" placeholder="Enter class name" required>
                    </div>

                    <div class="mb-3">
                        <label for="classDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="classDescription" name="classDescription" placeholder="Enter class description" required></textarea>
                    </div>

                    <div class="mb-3">
                        <label for="classLocation" class="form-label">Location</label>
                        <input type="text" class="form-control" id="classLocation" name="classLocation" placeholder="Enter location" required>
                    </div>

                    <div class="mb-3">
                        <label for="classPrice" class="form-label">Price</label>
                        <div class="input-group">
                            <span class="input-group-text">£</span>
                            <input type="number" class="form-control" id="classPrice" name="classPrice" placeholder="Amount" min="0" required>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save Class</button>
                </div>
            </form>
        </div>
    </div>
</div>

{{#classes}}
    <div class="modal fade" id="editClassModal-{{_id}}" tabindex="-1" aria-labelledby="editClassModalLabel-{{_id}}" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">

                <form action="/api/classes/edit" method="POST" novalidate>
                    <input type="hidden" name="classId" value="{{_id}}">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editClassModalLabel-{{_id}}">Edit Class - {{name}}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">

                        <div class="mb-3">
                            <label for="className-{{_id}}" class="form-label">Class Name</label>
                            <input type="text" class="form-control" id="className-{{_id}}" name="className" value="{{name}}" placeholder="Enter class name" required>
                        </div>

                        <div class="mb-3">
                            <label for="classDescription-{{_id}}" class="form-label">Description</label>
                            <textarea class="form-control" id="classDescription-{{_id}}" name="classDescription" placeholder="Enter class description" required>{{description}}</textarea>
                        </div>

                        <div class="mb-3">
                            <label for="classLocation-{{_id}}" class="form-label">Location</label>
                            <input type="text" class="form-control" id="classLocation-{{_id}}" name="classLocation" value="{{location}}" placeholder="Enter location" required>
                        </div>

                        <div class="mb-3">
                            <label for="classPrice-{{_id}}" class="form-label">Price</label>
                            <div class="input-group">
                                <span class="input-group-text">£</span>
                                <input type="number" class="form-control" id="classPrice-{{_id}}" name="classPrice" value="{{price}}" placeholder="Amount" min="0" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Existing Timeslots:</label>
                            <div id="existingTimeslots-{{_id}}" class="d-flex flex-wrap gap-2">
                                {{#timeslots}}
                                    <span class="badge bg-info text-dark timeslot-badge" data-timeslot="{{.}}">{{.}}</span>
                                {{/timeslots}}
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-warning">Update Class</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{{/classes}}

<div class="modal fade" id="timeslotManagementModal" tabindex="-1" aria-labelledby="timeslotManagementModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <form action="/api/classes/timeslots/update" method="POST" novalidate>
                <div class="modal-header">
                    <h5 class="modal-title" id="timeslotManagementModalLabel">Timeslot Management for <span id="tmClassName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <input type="hidden" id="tmClassId" name="classId" value="">

                    <div class="mb-3">
                        <label class="form-label">Existing Timeslots:</label>
                        <div id="tmTimeslotList" class="d-flex flex-wrap gap-2">

                        </div>
                    </div>

                    <hr>
                    <h6>Add New Timeslot</h6>
                    <div class="mb-3">
                        <label for="tmDate" class="form-label">Date</label>
                        <input type="date" class="form-control" id="tmDate" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Time Range</label>
                        <div class="row">
                            <div class="col">
                                <input type="time" class="form-control" id="tmStartTime" required>
                            </div>
                            <div class="col">
                                <input type="time" class="form-control" id="tmEndTime" required>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-outline-primary mb-3" id="tmAddBtn">Add Timeslot</button>

                    <input type="hidden" id="tmTimeslotsCSV" name="timeslotsCSV" value="">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save Timeslots</button>
                </div>
            </form>
        </div>
    </div>
</div>

{{#classes}}
    <div class="modal fade" id="participantsClassModal-{{_id}}" tabindex="-1" aria-labelledby="participantsClassModalLabel-{{_id}}" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="participantsClassModalLabel-{{_id}}">Participants for {{name}}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul class="list-group">
                        {{#participants}}
                            <li class="list-group-item">{{name}} ({{email}})</li>
                        {{/participants}}
                        {{^participants}}
                            <li class="list-group-item">No participants yet.</li>
                        {{/participants}}
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
{{/classes}}

<div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <form action="/api/users/add" method="POST" novalidate>
                <div class="modal-header">
                    <h5 class="modal-title" id="addUserModalLabel">Add New User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <div class="mb-3">
                        <label for="userName" class="form-label">User Name</label>
                        <input type="text" class="form-control" id="userName" name="userName" placeholder="Enter user name" required>
                    </div>

                    <div class="mb-3">
                        <label for="userEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="userEmail" name="userEmail" placeholder="Enter email" required>
                    </div>

                    <div class="mb-3">
                        <label for="userPassword" class="form-label">Password</label>
                        <input type="password" class="form-control" id="userPassword" name="userPassword" placeholder="Enter password" required>
                    </div>

                    <div class="mb-3">
                        <label for="userRole" class="form-label">Role</label>
                        <select class="form-select" id="userRole" name="userRole" required>
                            <option value="user">User</option>
                            <option value="organiser">Organiser</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save User</button>
                </div>
            </form>
        </div>
    </div>
</div>

{{#users}}
    <div class="modal fade" id="editUserModal-{{_id}}" tabindex="-1" aria-labelledby="editUserModalLabel-{{_id}}" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">

                <form action="/api/users/edit" method="POST" novalidate>
                    <input type="hidden" name="userId" value="{{_id}}">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editUserModalLabel-{{_id}}">Edit User - {{name}}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">

                        <div class="mb-3">
                            <label for="userName-{{_id}}" class="form-label">User Name</label>
                            <input type="text" class="form-control" id="userName-{{_id}}" name="userName" value="{{name}}" placeholder="Enter user name" required>
                        </div>

                        <div class="mb-3">
                            <label for="userEmail-{{_id}}" class="form-label">Email</label>
                            <input type="email" class="form-control" id="userEmail-{{_id}}" name="userEmail" value="{{email}}" placeholder="Enter email" required>
                        </div>

                        <div class="mb-3">
                            <label for="userRole-{{_id}}" class="form-label">Role</label>
                            <select class="form-select" id="userRole-{{_id}}" name="userRole" required>
                                <option value="organiser" {{#isOrganiser}}selected{{/isOrganiser}}>Organiser</option>
                                <option value="user" {{^isOrganiser}}selected{{/isOrganiser}}>User</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="userPassword-{{_id}}" class="form-label">Password</label>
                            <input type="password" class="form-control" id="userPassword-{{_id}}" name="userPassword" placeholder="Enter new password (optional)">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-warning">Update User</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{{/users}}

<script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<script>
    // When a "Timeslot Management" button is clicked, open the modal and load existing timeslots
    const manageButtons = document.querySelectorAll('.manage-timeslots-btn');
    manageButtons.forEach(button => {
        button.addEventListener('click', function() {
            const classId = this.getAttribute('data-classid');
            const className = this.getAttribute('data-classname');
            document.getElementById('tmClassId').value = classId;
            document.getElementById('tmClassName').textContent = className;

            // For demo purposes, load dummy timeslots if available.
            const dummyTimeslots = [];
            const listContainer = document.getElementById('tmTimeslotList');
            listContainer.innerHTML = "";
            document.getElementById('tmTimeslotsCSV').value = dummyTimeslots.join(',');
            dummyTimeslots.forEach((ts, index) => {
                const badge = createTimeslotBadge(ts, index);
                listContainer.appendChild(badge);
            });
            document.getElementById('tmDate').value = "";
            document.getElementById('tmStartTime').value = "";
            document.getElementById('tmEndTime').value = "";
        });
    });

    function formatTimeslot(dateStr, startTime, endTime) {
        const parts = dateStr.split('-');
        if (parts.length !== 3) return dateStr;
        return parts[2] + '/' + parts[1] + '/' + parts[0] + ' - ' + startTime + ' - ' + endTime;
    }

    function createTimeslotBadge(timeslotCSV, index) {
        const parts = timeslotCSV.split(' ');
        if (parts.length !== 2) return document.createTextNode(timeslotCSV);
        const formatted = formatTimeslot(parts[0], parts[1].split('-')[0], parts[1].split('-')[1]);
        const badge = document.createElement('span');
        badge.className = 'badge bg-success fs-6 p-2';
        badge.style.cursor = 'pointer';
        badge.textContent = formatted + " ×";
        badge.addEventListener('click', function() {
            badge.remove();
            updateTimeslotsCSV();
        });
        return badge;
    }

    document.getElementById('tmAddBtn').addEventListener('click', function() {
        const dateInput = document.getElementById('tmDate');
        const startInput = document.getElementById('tmStartTime');
        const endInput = document.getElementById('tmEndTime');
        const dateVal = dateInput.value;
        const startVal = startInput.value;
        const endVal = endInput.value;
        if (!dateVal || !startVal || !endVal) {
            alert("Please fill in date, start time, and end time.");
            return;
        }
        const timeslot = dateVal + ' ' + startVal + '-' + endVal;
        const formatted = formatTimeslot(dateVal, startVal, endVal);
        const listContainer = document.getElementById('tmTimeslotList');
        const badge = createTimeslotBadge(timeslot, listContainer.childElementCount);
        listContainer.appendChild(badge);
        updateTimeslotsCSV();
        dateInput.value = "";
        startInput.value = "";
        endInput.value = "";
    });

    function updateTimeslotsCSV() {
        const listContainer = document.getElementById('tmTimeslotList');
        const badges = listContainer.querySelectorAll('.badge');
        const timeslots = [];
        badges.forEach(badge => {
            const text = badge.textContent.replace(' ×', '').trim();
            timeslots.push(text);
        });
        document.getElementById('tmTimeslotsCSV').value = timeslots.join(',');
    }
</script>